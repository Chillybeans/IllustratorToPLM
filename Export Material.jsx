//========================================================================================//// Export opened AI-drawing in a folder to SVG-graphics.//// Run this script from Adobe Illustrator -> file -> scripts -> browse (select this file)//// Context: PDM G-Star// Author: Xavier Chamuleau / Giel Scharff// $Log:  62753: Export Material.jsx ////    Rev 1.4    8-11-2007 13:08:44  GS// pad van de inboxes gewijzigd (hoofdletter)////    Rev 1.3    2-11-2007 15:05:06  GS// bugfix voor materials die eindigen met een . (punt)////    Rev 1.2    27-6-2007 16:46:36  GS// Nieuwe CS3 variant: ook checks bij labels en material////    Rev 1.1    27-6-2007 15:46:18  GS// Nieuwe CS3 variant//// bewaar ai file voor svgz-en; check zelfde layers als artwork//========================================================================================//// Debug options// $.bp( someValue == 0 ); // Conditional breakpoint// $.level = 0; // Suppress the debugger from being opened;// $.level = 1; // Open the debugger at the beginning of the script;// $.level = 2; // Open the debugger if a run-time error occurs////========================================================================================// Constants//========================================================================================// FileSystem: Windows or Mac?var FS_WIN = Folder.fs == "Windows";var FS_MAC = Folder.fs == "Macintosh";SCRIPT_NAME = "Export Material";// juiste padMATERIAL_EXPORT_PATH      = "/Volumes/PD/PDM/Material/In";//MATERIAL_EXPORT_PATH      = "~/Desktop/In";var ARTWORK_LAYERS = new String("KADER,MONOCHROME,ABC");//========================================================================================// Start execution point//========================================================================================Main();//========================================================================================// Main execution path//========================================================================================function Main(){  try  {    var document= app.activeDocument    if ( document != null )    {      CheckLayers(document.layers);      // Save het document eerst zodat de svg altijd hetzelfde is als het bewaarde      // document. Dit doen we na de check zodat we alleen een goedsituatie bewaren!      document.save();      var saveName = document.name;      saveName = saveName.substring(0,saveName.lastIndexOf(".ai"));      // Save het document nu als SVG. Dit sluit tevens het document!       if ( saveName != null )         if ( checkValidMaterial(saveName) )           SaveAsSVG(document, saveName);    }  }  catch (e)  {    alert(SCRIPT_NAME + " execution stopped, error: " + "\n\n" + e);  }}//========================================================================================//========================================================================================// Check if the required predefined layers are present.//========================================================================================function CheckLayers(docLayers){  var list = ARTWORK_LAYERS.split(',');  var listCount = list.length;  var ontbreekt = "";  var errorMsg = "";  var meerDanEen = false;  for ( i = 0; i < listCount; i++ )  {    var bestaat = false;    var layerName = new String(list[i]);    bestaat = IsElementOf(layerName, docLayers);    if ( ! bestaat )    {      if ( ontbreekt != "" )      {        ontbreekt = ontbreekt + ', ';        meerDanEen = true;      }      ontbreekt = ontbreekt + layerName    }  }  if ( ontbreekt != "" ) {    if ( meerDanEen )      errorMsg = "De volgende lagen ontbreken: " + ontbreekt    else      errorMsg = "De volgend laag ontbreekt: " + ontbreekt;    throw(errorMsg);  }}//========================================================================================//========================================================================================// Utility: Is candidate element of array?//========================================================================================function IsElementOf(candidate, list){  var result = false;  for ( i = 0; i < list.length; i++)  {    if (candidate == list[i].name) {      result = true;      break;    }  }  return result;}//========================================================================================//========================================================================================// Save the document as an SVG//========================================================================================function SaveAsSVG(document, newname){  var targetFolder = Folder(MATERIAL_EXPORT_PATH);  if (! targetFolder.exists) {    // geef een melding en     throw("Onderstaande folder niet gevonden, is de netwerkverbinding gemaakt? \n\n" +           MATERIAL_EXPORT_PATH);  }  var exportOptions = new ExportOptionsSVG();  var exportType = ExportType.SVG;  var targetFile = MakeTempInvisibleFile(targetFolder, newname, ".ai");  // alert(targetFile);  exportOptions.embedRasterImages = true;  exportOptions.compressed = true;  exportOptions.embedAllFonts = false;  exportOptions.fontSubsetting = SVGFontSubsetting.GLYPHSUSED;  exportOptions.cssProperties = SVGCSSPropertyLocation.PRESENTATIONATTRIBUTES;  exportOptions.optimezForSVGViewer = true;  document.exportFile( targetFile, exportType, exportOptions );  document.close( SaveOptions.DONOTSAVECHANGES );  var exportedFile = MakeTempInvisibleFile(targetFolder, newname, ".svgz");  // alert(exportedFile);  if (exportedFile.exists) {    if (! exportedFile.rename(newname+ ".svgz")) {      // bij aanwezig zijn oude file, deze proberen te deleten en vervolgens nogmaal renamen:      var fl = new File(targetFolder + "/" + newname + ".svgz");      // alert(fl);      if (fl.remove())         exportedFile.rename(newname+ ".svgz")      else        alert(SCRIPT_NAME + " is niet goed gelukt, oude file is nog aanwezig en niet te overschrijven!")     }  }    else    alert(SCRIPT_NAME + " is niet goed gelukt!")  }function MakeTempInvisibleFile(folder, naam, ext){	return new File(folder + "/._X" + naam + "X" + ext);}//========================================================================================function checkValidMaterial( mat ) {  // Opbouw van de expressie:  // begin van de tekst: ^  // valid tekst (twee tekens, max 8 tekens, geen spatie aan begin of eind): [^<>"?\*\/: ]{1}[^<>"?\*\/:]{0,6}[^<>"?\*\/: ]{1}  // einde van de tekst: $  matRegex = /^([^<>"?\*\/: ]{1}[^<>"?\*\/:]{0,6}[^<>"?\*\/: ]{1})$/;  if( !mat.match( matRegex ) ) {    alert( "svgz-filenaam is onjuist. Juist voorbeeld: 12345678 of AB1" );    return false;  }  return true;}